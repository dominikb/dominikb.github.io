{"componentChunkName":"component---src-pages-blog-js","path":"/blog/","result":{"data":{"allMarkdownRemark":{"totalCount":7,"edges":[{"node":{"excerpt":"During an assignment for my lecture Software-Development using Enterprise Technologies we had to develop an auctioning system using Spring Boot. The interaction with this system had to be possible…","html":"<p> During an assignment for my lecture <em>Software-Development using Enterprise Technologies</em> we had to develop an auctioning system using Spring Boot. The interaction with this system had to be possible with a CLI developed using <a href=\"https://spring.io/projects/spring-shell\">Spring Shell</a>.</p>\n<p> The command we will look at in this post is the command <strong>bid</strong> which allows to place a on an article for a given user. The interface will look roughly like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> place-bid --article <span class=\"token number\">10</span> --buyer <span class=\"token number\">5</span> --price <span class=\"token number\">124</span> EUR</code></pre></div>\n<h2>Starting out</h2>\n<p>The method signature I started with was using simple, primitive objects as arguments which Spring could automatically parse from the user input.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ShellMethod</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Place a bid on an article for a given customer\"</span><span class=\"token punctuation\">,</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"place-bid\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">bid</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">Long</span> articleId<span class=\"token punctuation\">,</span>\n                  <span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">Long</span> customerId<span class=\"token punctuation\">,</span>\n                  <span class=\"token annotation punctuation\">@ShellOption</span><span class=\"token punctuation\">(</span>arity <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> price<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>This left a lot to be desired. First, I want the price to use my abstraction <code class=\"language-text\">CurrencyAmount</code> which combines a numeric value with a unit <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>. This was something I needed multiple times for other commands as well and having the conversion logic repeated for multiple commands seemed like a bad move.</p>\n<p>So I looked up how Spring Shell converts user input to method arguments. It turns out converting is done by having a <code class=\"language-text\">Converter&lt;Source, Target></code> component registered - <em>who could've thought</em>. As I had already some helper methods in place to convert a string into a <code class=\"language-text\">CurrencyAmount</code> this was straightforward:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CurrencyAmountConverter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Converter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CurrencyAmount</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CurrencyAmount</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> parts <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">CurrencyAmount</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>\n                <span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseLong</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">Currency</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromString</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Et voilà - now we have improved our command signature significantly already.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ShellMethod</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Place a bid on an article for a given customer\"</span><span class=\"token punctuation\">,</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"place-bid\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">bid</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">Long</span> articleId<span class=\"token punctuation\">,</span>\n                  <span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">Long</span> customerId<span class=\"token punctuation\">,</span>\n                  <span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">CurrencyAmount</span> price<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<h2>Continuing this thought</h2>\n<p>Now I was wondering if it was possible to even extract loading of entities.</p>\n<p>It turns out this works just the same: Implementing a converter <code class=\"language-text\">Converter&lt;String, Customer></code> simply worked.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomerLoader</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Converter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Customer</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token annotation punctuation\">@Autowired</span> <span class=\"token keyword\">private</span> <span class=\"token class-name\">CustomerService</span> customerService<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Customer</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> customerService<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseLong</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EntityNotFoundException</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token string\">\"Could not find customer for id '\"</span>  <span class=\"token operator\">+</span> source <span class=\"token operator\">+</span> <span class=\"token string\">\"'.\"</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>After implementing converters for all my entities my problem was solved and it resulted in a nice looking interface for implementing shell commands. Or so it seemed at first...</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ShellMethod</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Place a bid on an article for a given customer\"</span><span class=\"token punctuation\">,</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"place-bid\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">bid</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">Article</span> article<span class=\"token punctuation\">,</span>\n                  <span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">Customer</span> customer<span class=\"token punctuation\">,</span>\n                  <span class=\"token annotation punctuation\">@ShellOption</span> <span class=\"token class-name\">CurrencyAmount</span> price<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<h2>Troubles in paradise</h2>\n<p>As it turns out problems with lazy-loading arised when trying to access related entities. My first thought was to slap a <code class=\"language-text\">@Transactional()</code> annotation onto the command method but this did not resolve the lazy-loading errors.</p>\n<p>The reason for this was that entities loaded by a converter were not attached to an <code class=\"language-text\">EntityManager</code> and thus the relation proxy could not execute the lazy-loading query.</p>\n<h2>AOP to the rescue</h2>\n<p>Out of curiosity and because I was already down this rabbit-hole too far, I tried to also resolve this issue using a custom <code class=\"language-text\">Aspect</code>. For every <code class=\"language-text\">Entity</code> loaded and injected as an argument, I need to call <code class=\"language-text\">merge()</code> on an open <code class=\"language-text\">EntityManger</code>.</p>\n<p>This was my solution:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Aspect</span> <span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AutoloadedEntityAttacherAspect</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@PersistenceContext</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> entityManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Around</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shellCommands() &amp;&amp; within(io.dominikb.homework3.commands.*)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">attachObjectsToEntityManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProceedingJoinPoint</span> pjp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> args <span class=\"token operator\">=</span> pjp<span class=\"token punctuation\">.</span><span class=\"token function\">getArgs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> args<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAnnotationPresent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Entity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                args<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> pjp<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Pointcut</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@annotation(org.springframework.shell.standard.ShellMethod)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">shellCommands</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With having flexed my newly acquired knowledge about aspect-oriented programming I was satisfied with my solution and called it a day.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>For simplicity's sake and because floating point arithmetic is hard, my currency abstraction does not allow for cents.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CurrencyAmount</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> amount<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Currency</span> unit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">Currency</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">EURO</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"€\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">USD</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> representation<span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Currency</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> representation<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>representation <span class=\"token operator\">=</span> representation<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Currency</span> <span class=\"token function\">fromString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token string\">\"EUR\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"€\"</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Currency</span><span class=\"token punctuation\">.</span>EURO<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token string\">\"USD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"$\"</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Currency</span><span class=\"token punctuation\">.</span>USD<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">default</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No currency available for given string\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","id":"b21feb2e-079f-5594-8924-601389559d33","frontmatter":{"title":"Autoloading entities in Spring Shell commands","date":"March 25, 2022","tags":["java","spring","spring-boot"],"excerpt":null},"fields":{"slug":"/2022-03-spring-shell-entity-autoload/"}}},{"node":{"excerpt":"This guide is based on the works of Asrar from dev.to and adapted to PHP 8. If you dont have PHP 8 already install it using brew:  Download the latest version of xDebug.  Then build and install the…","html":"<p>This guide is based on the works of <a href=\"https://dev.to/asrar7787/mac-os-x-install-xdebug-with-multiple-php-versions-4377\">Asrar from dev.to</a> and adapted to PHP 8.</p>\n<p>If you dont have PHP 8 already install it using brew: <code class=\"language-text\">brew install php autoconf</code></p>\n<p>Download the latest version of <a href=\"https://xdebug.org/download\">xDebug</a>. </p>\n<p>Then build and install the extension.</p>\n<p>For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">wget</span> https://xdebug.org/files/xdebug-3.0.4.tgz\nextract xdebug-3.0.4.tgz\n\n<span class=\"token builtin class-name\">cd</span> xdebug-3.0.4\nphpize\n./configure\n<span class=\"token function\">make</span>\n\n<span class=\"token function\">mkdir</span> -p /usr/local/lib/php/extensions\n<span class=\"token function\">mv</span> modules/xdebug.so /usr/local/lib/php/extensions\n<span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span>\n<span class=\"token function\">rm</span> -rf xdebug-3.0.4\n\n<span class=\"token comment\"># Find the path to your php.ini</span>\nphp --ini <span class=\"token comment\"># e.g. /usr/local/etc/php/8.0/php.ini</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"zend_extension=/usr/local/lib/php/extensions/xdebug.so\"</span> <span class=\"token operator\">>></span> /usr/local/etc/php/8.0/php.ini</code></pre></div>\n<p>Next up it should look something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 737px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f1b905ecf41749c6db9da163caf87e01/d125e/xdebug-enabled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVR42q2RX0/TUBTA98Zr+QL6MXgCvwAk8An8ECa+6IMkxkQj8U9ghEXQYOKL8YVETWCBjgFlY0yHoaz/uxXW9rZd29B/a7k9dlUHiU8m3uSXc8699/ySe24Br9wv7N+7O7ZZeji+8eUrsVRaJ14+eUCslxaJ1cXXxMLjeeLT+3fEx/U1YvnFc+Lt8gLxYW2VKL16QxQXFomDrSpRI8vjPw6rY9jWCwUAKOjHjUfqRXMgI0Fl5R6SOQ6diwLqcAziz07RhSQgReTzXBEEpHUl1JNZpHZ45PU19dIyIqFNzw9dubBB0SttpgtNuQntrgSm4YKm6tDrXcC5okC308lRlG5Wa9C3DLDtc3BdPYsqOHYfaJoujYQkSRZZRgRR7saCLGKG4zAnilhFCGsZumFgLcOy7SwiHEQDHMZXOBwk2A+jOAxDEEVxeSQ8pA6KdI2Ck8pOwtQOUr5Rg9P9XTjZ3QG51QTpWwPYOgU0tZfnfZEDk2fBYNvppWEkYRQBz/PXQoEVimcnR0BubSR75XLarFahuVuBRmUbattloMqbOUfkNhztkPk+Vf4Mx5Wt1NaUxPM8EG4KvzfYIiepwOly0rPd1HJ8QEYfkGWBbpjQ0zRA5q8cmQ7Yjg19VwXXs1LH1RPXcUC4+WSGYZaCyxBCP4xD38eB7+EgCEZkM7pR+9j3h4TY97LoBfkMsycXR8KsWIkGEWQNaZAdhr/J6r8Igz/nwehOlM1QkqTrX261Wk8Nw7jSdd3MsP8REyGU1Ov1Z7lwuCYnJ2/Nzc1NTU9P35mZmfknhj2zs7NTExMTt3PZ0Pq/iOO48BNEw/RmZjHQ8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Working xdebug extension for php\"\n        title=\"Working xdebug extension for php\"\n        src=\"/static/f1b905ecf41749c6db9da163caf87e01/d125e/xdebug-enabled.png\"\n        srcset=\"/static/f1b905ecf41749c6db9da163caf87e01/63868/xdebug-enabled.png 250w,\n/static/f1b905ecf41749c6db9da163caf87e01/0b533/xdebug-enabled.png 500w,\n/static/f1b905ecf41749c6db9da163caf87e01/d125e/xdebug-enabled.png 737w\"\n        sizes=\"(max-width: 737px) 100vw, 737px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","id":"c07ee5dd-b162-58f4-87b5-a5209c37b675","frontmatter":{"title":"Setting up xDebug on MacOS","date":"June 02, 2021","tags":["php"],"excerpt":null},"fields":{"slug":"/2021-06-setting-up-xdebug-on-macos/"}}},{"node":{"excerpt":"Connecting to a different server from your CI job can be a hassle. Specifying the ssh connection parameters followed by the command to be executed can take quite a lot of space visually and cause all…","html":"<p>Connecting to a different server from your CI job can be a hassle. Specifying the ssh connection parameters followed by the command to be executed can take quite a lot of space visually and cause all kinds of trouble with linebreaks if you want to space out your command over multiple lines.</p>\n<p>A better way is to create an ssh configuration on your Runner and simplify this especially if you need to connect to the target server multiple times.\nLet me show you my solution and how it came about.</p>\n<h2>Connecting to a remote server</h2>\n<p>First up, you need to make all parameters available inside the job, for example by using the Gitlab CI parameters.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b5b00beedce63ef1e02899befd94c5cc/e8649/gitlab-ci-variables.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACtElEQVR42mWSW08TQRTH99EP4ANQKI3RCiSUUrFSuQhtoUlJjInfRhOXN332C8gjkBhefCYxUV7QptykIbbS225t99Jtd3d2Z3fnODNSIniSX8/ZmTn/+Z/uComZe68WUonNlZXlN6mnT8TJqagYjoyK45ExMTweumYsHBJHQkPi8MiQODI6zAlRwuOjYvTh/c1IJPyanrkrLM2vw8LiC5hPPYe5x3mYTeQgHl+DiYlleBBdhCiF5cmpZ3RvHR7Nsf0sxGfXYDqWpmRgafklJFN5CIdjCeHLfqH/9eDUPzy8cI+OLvHBwSne/3yCi8VLfFT8hdka4+S4ikulJr64kHHpvMnr8/MGLhTK+Hvhp1c8rqB3b9/PCIahoyDAAEAI++n3DSK3ZKJqKtG6Gs0K0XSNPyuqQhSlw9faNNsI8R7gEXh7ex/jgizLyDQtsCyL+H4AqK+DqctgtKvQlcsc/QqjVYGOXAdVqkBPa4HV06gM5k4sy/a2t7fjQqvVQrZtA8YuoQEedgA7FgQY0UsxeLQmHq0Jq01wkQWea4Nr9//ukYA7RAh5Ozs7caHT6SDXdakg5oIYe9Cnjo1ej9cuBSEHAtrnM+gUDJuuMXzfvykoyxJyHOda0PM8Nj50u112iDWA6zLBANg+4TkAl/b49LLgtmCjISEmQMe+cohZDaZpchF2AZtgIMgyu8S0LZC034Bc56ZgqVSxFUVhjgJmnzaQQb56g5xBBBTfxaSuyuTDt0+kY+oBE6QmMBWcEarVGtZ1jTtiYRgGNJtNPjJzxv4OBnN6m3+Dmgh2d3fjwtnZD71cLruNRsNWVRVJkoRqtRqq1+ucQd1ut/+DvVDaw/oc+vn1tra2poVsNptYXV19kk6nkzQnc7lccmNjI5nP529AzyUzmQzPAwY9NLP+RCwWu/MHJVMu8dJbSYgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Variables configured in Gitlab CI\"\n        title=\"Variables configured in Gitlab CI\"\n        src=\"/static/b5b00beedce63ef1e02899befd94c5cc/00d43/gitlab-ci-variables.png\"\n        srcset=\"/static/b5b00beedce63ef1e02899befd94c5cc/63868/gitlab-ci-variables.png 250w,\n/static/b5b00beedce63ef1e02899befd94c5cc/0b533/gitlab-ci-variables.png 500w,\n/static/b5b00beedce63ef1e02899befd94c5cc/00d43/gitlab-ci-variables.png 1000w,\n/static/b5b00beedce63ef1e02899befd94c5cc/aa440/gitlab-ci-variables.png 1500w,\n/static/b5b00beedce63ef1e02899befd94c5cc/e8950/gitlab-ci-variables.png 2000w,\n/static/b5b00beedce63ef1e02899befd94c5cc/e8649/gitlab-ci-variables.png 2968w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can now connect to an external server using the provided credentials:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># .gitlab.ci.yml</span>\n\nDeploy:\n  script:\n    - <span class=\"token string\">\"ssh <span class=\"token variable\">${DEPLOY_SSH_SERVER}</span> -l <span class=\"token variable\">${DEPLOY_SSH_USER}</span> -p <span class=\"token variable\">${DEPLOY_SSH_PORT}</span> -i <span class=\"token variable\">${DEPLOY_SSH_PRIVATE_KEY}</span> 'ls -la <span class=\"token environment constant\">$HOME</span>'\"</span></code></pre></div>\n<p>But specifying those ssh parameters for every command is tedious. There is a better way.</p>\n<h2>Creating an ssh configuration</h2>\n<p>Running one-off commands using the parameterized ssh command is fine. Problems occurred for me when I needed to connect to multiple times or to multiple different servers.</p>\n<p>Always parameterizing the ssh command creates a lot of visual noise and makes it harder to understand what the given line is actually supposed to do.</p>\n<p>Try to scan this script and figure out what happens here:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">Deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> \n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"scp -P ${DEPLOY_SSH_PORT} -i ${DEPLOY_SSH_PRIVATE_KEY} -r artifacts ${DEPLOY_SSH_USER}@${DEPLOY_SSH_SERVER}:/opt/deploy_artifacts\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh -p ${DEPLOY_SSH_PORT} -i ${DEPLOY_SSH_PRIVATE_KEY} ${DEPLOY_SSH_USER}@${DEPLOY_SSH_SERVER} 'systemctl stop my-application'\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh -p ${DB_SSH_PORT} -i ${DB_SSH_PRIVATE_KEY} ${DB_SSH_USER}@${DB_SSH_SERVER} 'mysqldump --all-databases > backup.sql'\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh -p ${DEPLOY_SSH_PORT} -i ${DEPLOY_SSH_PRIVATE_KEY} ${DEPLOY_SSH_USER}@${DEPLOY_SSH_SERVER} 'systemctl start my-application'\"</span></code></pre></div>\n<p>Now again with a cleaner version where we separate configuration and workload:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">Deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./ci/setup_ssh_configuration deploy_server ${DEPLOY_SSH_SERVER} ${DEPLOY_SSH_PORT} ${DEPLOY_SSH_USER} ${DEPLOY_SSH_PRIVATE_KEY}\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./ci/setup_ssh_configuration db_server ${DB_SSH_SERVER} ${DB_SSH_PORT} ${DB_SSH_USER} ${DB_SSH_PRIVATE_KEY}\"</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"scp -r artifacts deploy_server:/opt/deploy_artifacts\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh deploy_server    'systemctl stop my-application'\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh db_server        'mysqldump --all-databases > backup.sql'\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh deploy_server    'systemctl start my-application'\"</span></code></pre></div>\n<p>By using a <code class=\"language-text\">before_script</code> we create a clear visual distinction between the configuration setup and the work that is actually done.</p>\n<p><strong>./ci/setup_ssh_configuration.sh</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\n<span class=\"token builtin class-name\">set</span> -euo pipefail\n\n<span class=\"token function\">mkdir</span> -p ~/.ssh\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span>\"\nHost <span class=\"token variable\">${1}</span>\n    Target <span class=\"token variable\">${2}</span>\n    Port <span class=\"token variable\">${3}</span>\n    User <span class=\"token variable\">${4}</span>\n    IdentifyFile <span class=\"token variable\">${5}</span>\n<span class=\"token string\">\"\"</span>\" <span class=\"token operator\">>></span> <span class=\"token string\">\"~/.ssh/config\"</span></code></pre></div>\n<h3>Even shorter configuration</h3>\n<p>The <code class=\"language-text\">before_script</code> can be even shorter if we accept a naming convention for those SSH connection parameters:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># {PREFIX}_SSH_SERVER {PREFIX}_SSH_USER ...</span></code></pre></div>\n<p>With some edits in our <code class=\"language-text\">setup_ssh_configuration</code> script we can reduce the <code class=\"language-text\">yml</code> config to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># .gitlab.ci.yml</span>\n\n<span class=\"token key atrule\">Deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./ci/setup_ssh_configuration deploy_server DEPLOY\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./ci/setup_ssh_configuration db_server DB\"</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"scp -r artifacts deploy_server:/opt/deploy_artifacts\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh deploy_server    'systemctl stop my-application'\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh db_server        'mysqldump --all-databases > backup.sql'\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ssh deploy_server    'systemctl start my-application'\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n<span class=\"token comment\"># ./ci/setup\\_ssh\\_configuration.sh</span>\n\n<span class=\"token builtin class-name\">set</span> -euo pipefail\n\n<span class=\"token function\">mkdir</span> -p ~/.ssh\n\n<span class=\"token assign-left variable\">target</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_HOST\"</span>\n<span class=\"token assign-left variable\">port</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_PORT\"</span>\n<span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_USER\"</span>\n<span class=\"token assign-left variable\">keypath</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_PRIVATE_KEY\"</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span>\"\nHost <span class=\"token variable\">${1}</span>\n    Target <span class=\"token variable\">${<span class=\"token operator\">!</span>target}</span>\n    Port <span class=\"token variable\">${<span class=\"token operator\">!</span>port}</span>\n    User <span class=\"token variable\">${<span class=\"token operator\">!</span>user}</span>\n    IdentifyFile <span class=\"token variable\">${<span class=\"token operator\">!</span>keypath}</span>\n<span class=\"token string\">\"\"</span>\" <span class=\"token operator\">>></span> <span class=\"token string\">\"~/.ssh/config\"</span></code></pre></div>\n<h2>Reusing connections</h2>\n<p>One more improvement that can be made is to reuse the ssh connections.</p>\n<p>Depending on your CI-Setup you could have multiple scripts that connect to the same host within the same pipeline stage. Now, if your executed commands are all sub-second, the overhead of creating a new ssh session each time can be relatively large.</p>\n<p>You can improve upon this by once more extending the <code class=\"language-text\">setup_ssh_configuration.sh</code> to add the configuration for reusing previous TCP connections to the same host:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n<span class=\"token comment\"># ./ci/setup\\_ssh\\setup_ssh_configuration.sh</span>\n\n<span class=\"token builtin class-name\">set</span> -euo pipefail\n\n<span class=\"token function\">mkdir</span> -p ~/.ssh/sockets\n\n<span class=\"token assign-left variable\">target</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_HOST\"</span>\n<span class=\"token assign-left variable\">port</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_PORT\"</span>\n<span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_USER\"</span>\n<span class=\"token assign-left variable\">keypath</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${2}</span>_SSH_PRIVATE_KEY\"</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span>\"\nHost <span class=\"token variable\">${1}</span>\n    Target <span class=\"token variable\">${<span class=\"token operator\">!</span>target}</span>\n    Port <span class=\"token variable\">${<span class=\"token operator\">!</span>port}</span>\n    User <span class=\"token variable\">${<span class=\"token operator\">!</span>user}</span>\n    IdentifyFile <span class=\"token variable\">${<span class=\"token operator\">!</span>keypath}</span>\n    ControlMaster auto\n    ControlPath ~/.ssh/sockets/%r@%h-%p\n    ControlPersist <span class=\"token number\">600</span>\n<span class=\"token string\">\"\"</span>\" <span class=\"token operator\">>></span> <span class=\"token string\">\"~/.ssh/config\"</span></code></pre></div>\n<p>Read more about reusing connections for ssh <a href=\"https://puppet.com/blog/speed-up-ssh-by-reusing-connections\">https://puppet.com/blog/speed-up-ssh-by-reusing-connections</a></p>","id":"51478d69-8d4d-5756-a671-90aa392f10bf","frontmatter":{"title":"Painless SSH Setup in Gitlab CI","date":"October 13, 2020","tags":["gitlab","cicd","shell","ssh"],"excerpt":null},"fields":{"slug":"/2020-10-painless-ssh-setup-in-gitlab-ci/"}}},{"node":{"excerpt":"What is CI/CD? CI/CD is short for Continues Integration and Continues Delivery (sometimes also called Continues Deployment). Both terms group steps and actions that occur during the lifetime of your…","html":"<h2>What is CI/CD?</h2>\n<p>CI/CD is short for <strong>C</strong>ontinues <strong>I</strong>ntegration and <strong>C</strong>ontinues <strong>D</strong>elivery (sometimes also called <strong>C</strong>ontinues <strong>D</strong>eployment). Both terms group steps and actions that occur during the lifetime of your project. Red Hat has <a href=\"https://www.redhat.com/en/topics/devops/what-is-ci-cd\">a great article</a>, where all these acronyms are explained in a little more detail.</p>\n<p>I will go over my setup, mainly for CI jobs and tools, and give a short explainer, as well as some useful links to get you started with your own pipeline. For this post, I will spare the topic of automatic deployment.</p>\n<h2>What advantages do you gain?</h2>\n<p>The effects may vary depending on a variety of factors, but speaking from personal experience these are some areas you will benefit in:</p>\n<ul>\n<li>Keeping the code base organized</li>\n<li>Having consistent formatting throughout your codebase</li>\n<li>Giving (new) contributors some guidelines to follow when developing their feature</li>\n<li>Bringing value to your users faster</li>\n</ul>\n<h2>Code Functionality and Quality</h2>\n<p>Arguably the most important part of setting up a pipeline is getting set up with tests. Testing your application thoroughly will ensure that your business logic works the way it should.</p>\n<h3>Automated Testing</h3>\n<p>In order to get the most out of your tests, they should run on all of your supported PHP versions. Another criterion to test for is your third-party dependencies. When you require a package with <code class=\"language-text\">composer</code> , you can give it some version constraints. To ensure that we actually support the versions specified, we should run our tests multiple times with different <code class=\"language-text\">composer install</code> flags.</p>\n<h3>Travis CI (<a href=\"https://docs.travis-ci.com/user/languages/php/\">Link</a>)</h3>\n<p>Travis CI is easy to set up, free to use for open source projects and a somewhat standard tool in the PHP community for automatically running your tests.\nIt integrates nicely with Github and by following their <a href=\"https://docs.travis-ci.com/user/tutorial/\">setup instructions</a>, you are up and running in a matter of minutes. It’s also easily configured by putting a <em>.travis-ci.yml</em> file in your project.</p>\n<ul>\n<li><a href=\"https://github.com/laravel/framework/blob/5.8/.travis.yml\">Laravel Travis CI configuration</a></li>\n<li><a href=\"https://github.com/spatie/laravel-query-builder/blob/1.17.0/.travis.yml\">Spatie Package Travis CI configuration</a></li>\n</ul>\n<h3>Code Duplication</h3>\n<p>Given a growing codebase, it’s easy to forget that some code-snippet, that you’ve just introduced with your new feature, has already been used somewhere. The duplicated code will lead to a messy codebase and add maintenance cost to your project.</p>\n<h3>PHP Duplicate Code Detector (<a href=\"https://github.com/sebastianbergmann/phpcpd\">Github</a>)</h3>\n<p><a href=\"https://sebastian-bergmann.de/\">Sebastian Bergmann</a>, who created PHPUnit, also created a PHP CLI tool that automatically detects duplicate code.</p>\n<p>It may take some time to find a good balance of parameters for your project, but it is an easy win regarding clean code, that I can highly recommend.</p>\n<h3>Code Coverage</h3>\n<p>A metric that is often mentioned in regards to testing is “Code Coverage”. It describes, how much of your production code is covered when running your tests.</p>\n<p>Although the sound of saying “I have 100 percent code coverage” might be compelling to strive for high coverage, this alone does not guarantee, that your code is well tested and functional. More important than a high coverage is that code coverage allows you to track down paths in your application, that are not tested at all.</p>\n<h3>Scrutinizer CI (<a href=\"https://scrutinizer-ci.com/\">Website</a>)</h3>\n<p>Scrutinizer CI is a quite powerful tool, that offers lots of insights into your code. Besides running tests for code coverage, it also analyses the complexity of your code and brings up potential issues, that otherwise may go undiscovered.</p>\n<p>It’s free for open source projects and especially easy to set up for your Github projects by following the <a href=\"https://scrutinizer-ci.com/docs/guides/php/continuous-integration-deployment\">setup-up guide</a>.</p>\n<h2>Code Formatting</h2>\n<p>Consistent styling helps contributors and consumers of your code, to read and comprehend code more easily.</p>\n<p>Code formatting is a very opinionated topic and it’s borderline impossible to come to terms with everybody on how code should be formatted. (Spaces!)</p>\n<p>It’s best to define a set of styles you want to adhere to when developing a specific project right at the beginning. Generally, it is recommended to adhere to PSR-1 and PSR-2, but as long as you stick to a consistent style and enforce it in your whole project, you are good to go.</p>\n<p><strong>(PSR is short for PHP Standard Recommendation and is issued by the PHP-FIG. You can read more about them here.)</strong></p>\n<h3>Tools</h3>\n<p>Personally, I’ve been mainly using two tools for enforcing coding styles.</p>\n<h3>PHP CS Fixer (<a href=\"https://github.com/FriendsOfPHP/PHP-CS-Fixer\">Github Link</a>)</h3>\n<p>This is an open source project with highly customizable options. It can be run both locally and in a pipeline.</p>\n<p><a href=\"https://mlocati.github.io/php-cs-fixer-configurator/#version:2.16\">Mlocati’s PHP CS Fixer — Configurator</a> is a great addition to play around with all the possible options.</p>\n<ul>\n<li><a href=\"https://gist.github.com/dominikb/c06c426b2e1c0f55f3ac4fe04e6eabf5\">My personal PHP CS configuration</a></li>\n<li><a href=\"https://github.com/laravel/framework/blob/5.4/.php_cs\">Laravel PHP CS Configuration (up until 5.4)</a></li>\n</ul>\n<p>Adding custom scripts to your composer.json file makes it a breeze to quickly check if all your code is formatted correctly, or to let it be fixed automatically.</p>\n<h3>Style CI (Website)</h3>\n<p>Style CI is a tool that can be hooked into your repositories to automatically check for a given set of style rules on new pushes for a given branch. It offers additional functionality besides styling of PHP files, by also supporting Vue, CSS, JavaScript and more.</p>\n<p>It’s free for open source projects and can be easily configured with a <em>.styleci.yml</em> file in your repository.</p>\n<p>Check out their <a href=\"https://docs.styleci.io/\">documentation</a> to find out more.</p>\n<h2>Code Integrity</h2>\n<p>We use a lot of third-party code within our applications, that helps us do things more quickly, and that is fine. However, this could potentially expose us to security vulnerabilities.</p>\n<p>Another problem could be, that we do not always check thoroughly enough, how our dependencies are licensed.</p>\n<h3>SensioLabs Security Checker (<a href=\"https://github.com/sensiolabs/security-checker\">Github</a>)</h3>\n<p>Sensio Labs offers a tool that helps us to determine if we use dependencies with known security vulnerabilities. It reads from your <em>composer.lock</em> file and checks your dependencies and versions against their records.</p>\n<h3>Checking Licences</h3>\n<p>Composer comes with a pre-packed command that scans your dependencies and lists all of them with their associated licenses.</p>\n<p>Run <strong>composer licenses</strong> within your project to get a listing of your dependencies, their installed version, and their used license.</p>\n<p>I am currently working on a CLI tool that empowers the built-in composer command, adds additional information to used licenses and lets your pipeline fail when unwanted licenses were used within third-party dependencies. You can keep up with the development <a href=\"https://github.com/dominikb/composer-license-checker\">here</a>.</p>","id":"2bade56b-93dd-5fe5-898a-a3f9f21b44cc","frontmatter":{"title":"Getting started with CI/CD in PHP","date":"March 24, 2019","tags":["php","gitlab","cicd"],"excerpt":null},"fields":{"slug":"/2019-03-getting-started-with-ci-cd-in-php/"}}},{"node":{"excerpt":"I know this probably comes a bit late, after all, we are already two weeks into the new year, but after reading a lot of reviews from other people, especially devs, writing about their recap of 201…","html":"<p>I know this probably comes a bit late, after all, we are already two weeks into the new year, but after reading a lot of reviews from other people, especially devs, writing about their recap of 2018 and their outlook for this year, I was inspired and finally got around to put my own agenda into words.</p>\n<p>This serves a few goals: Firstly, it helps me reach my goal about blogging, that I set out to achieve in 2019 and secondly, it aids me in keeping myself accountable for reaching my SMART goals.</p>\n<p>If you’ve never head the term “SMART goal” before, this is a way to set more specific, less abstract goals. (<a href=\"https://en.wikipedia.org/wiki/SMART_criteria\">Wikipedia</a>)</p>\n<p>That’s how I’making more out of my New Year’s resolutions than just keeping them empty phrases.</p>\n<h2>My recap of 2018</h2>\n<p>At my current company, we develop a lot of PHP and admittedly I’ve been at most a mediocre PHP programmer when I joined the company back in August 2017. So my main objective at the beginning of 2018 was to become better at writing PHP. As I was mostly writing frontend code, I also tried dipping my toes into designing a little bit. Although I quite quickly realized that this isn’t really my field of expertise and does not bear as much satisfaction as writing code, I’m happy I gave it a shot.</p>\n<h3>Becoming a better developer</h3>\n<p>Throughout the year multiple things happened, that made me a better developer. I started following different blogs, Twitter accounts and became an enthusiastic listener of podcasts. This got me more and more involved in the community, especially around PHP Laravel, so that I can keep up with the latest and greatest things happening out there.</p>\n<p>During last year I also took a few online courses, most notably I got myself an account at Laracasts, which is an invaluable resource for everyone trying to get into PHP development with Laravel.</p>\n<h3>Open Source &#x26; Hacktoberfest</h3>\n<p>For quite some time I’ve wanted to contribute to Open Source projects. Mostly, because I love programming, but also because this is a great way to exercise and help out other members of the community. This year’s <a href=\"https://hacktoberfest.digitalocean.com/\">Hacktoberfest</a> finally got me started.</p>\n<p>I’ve been put off of contributing to Open Source projects, mostly because of there being lots of new things to learn: How do I open a pull request? What are the requirements for contributions? What happens if my pull request does not meet all the acceptance criteria?</p>\n<p>Hacktoberfest was a great way to myself started by picking some easy issues and eventually opening my first pull requests.</p>\n<p>Since then, I’ve made multiple contributions.</p>\n<h3>Reading, reading, reading …</h3>\n<p>Out of the countless articles, blog posts and books I read, Robert C. Martin’s “The Clean Coder” struck out the most and probably is the single best book recommendation for aspiring coders like me.</p>\n<p>Although I’ve not been coding professionally for too long, lots of scenarios and problems described in this book, I’ve been involved in one way or another.</p>\n<p>It gave me some great insights into how to approach topics related to programming that are not code-specific, like communicating with different stakeholders and acting professionally.</p>\n<p>The most valuable lesson though was, that I learned about the advantages of tests and got to experience the joy of Test Driven Development, which I’ve been a fan of ever since.</p>\n<h3>Personal</h3>\n<p>The most impactful change I’ve taken from a non-professional point of view happened back in September with me picking up going to school again.</p>\n<p>This year I’ve decided that I want to improve my skills by enrolling at <a href=\"https://www.fh-ooe.at/en/hagenberg-campus/\">FH Hagenberg</a> and studying Software Engineering. As I dropped out of school without finishing my A-Level exams, I decided to gain my qualification by attending evening school for two semesters.</p>\n<p>Although going to school 3 to 4 evenings a week while working full time does take up a lot of my time, I’m still enthusiastic about it and I’m looking forward to starting my studies in October.</p>\n<p>My goals in 2019</p>\n<p>I’ve set myself some ambitious goals for the upcoming year.</p>\n<ul>\n<li>Blog more: I want to write at least 12 blog posts and redo my personal site (<a href=\"https://dominikb.io/\">https://dominikb.io/</a>) to include a section for blogging</li>\n<li>More Open Source: Double my contributions from last year and best case start maintaining an open source project</li>\n<li>Give a talk at a local meetup group</li>\n<li>Use more keyboard shortcuts: IntelliJ makes this easy with the help of <a href=\"https://plugins.jetbrains.com/plugin/9792-key-promoter-x\">Key Promoter X</a>, an excellent tool that keeps track of your mouse clicks</li>\n<li>Waste less time, become more efficient: This one is probably not as easily measurable as my other goals, but I still feel like it should be on this list.</li>\n</ul>\n<h2>Recommendations</h2>\n<h3>Podcasts</h3>\n<ul>\n<li><a href=\"http://www.fullstackradio.com/\">http://www.fullstackradio.com/</a></li>\n<li><a href=\"https://syntax.fm/\">https://syntax.fm/</a></li>\n<li><a href=\"https://softwareengineeringdaily.com/\">https://softwareengineeringdaily.com/</a></li>\n<li><a href=\"https://darknetdiaries.com/\">https://darknetdiaries.com/</a></li>\n</ul>\n<h3>Books</h3>\n<ul>\n<li>Microservices-Patterns</li>\n<li>The Clean Coder — Robert C. Martin</li>\n</ul>","id":"abca4785-3047-50e7-9620-deb7644532b3","frontmatter":{"title":"Looking forward to 2019","date":"January 12, 2019","tags":[],"excerpt":null},"fields":{"slug":"/2019-01-looking-forward-to-2019/"}}},{"node":{"excerpt":"During the last few months, I’ve read a lot of blog posts and guides that talk about the benefits and joys of TDD. Although they all were credible sources and I believed the points they made about all…","html":"<p>During the last few months, I’ve read a lot of blog posts and guides that talk about the benefits and joys of TDD.</p>\n<p>Although they all were credible sources and I believed the points they made about all the benefits you get when applying this style of development, I just could not quite get myself to try it out.</p>\n<p>The biggest hurdle for me seemed, that there were no clear instructions on how to get started.</p>\n<h2>My problem with Test Driven Development</h2>\n<p>How development works, how I have been taught and taught myself to write code, always followed a simple pattern:</p>\n<ul>\n<li>You grasp the existing problem and think of a solution</li>\n<li>You abstract the solution into a flow and break it down to smaller steps</li>\n<li>You implement those steps in code</li>\n</ul>\n<p>Of course, you should always follow the best practices of loose coupling or the use of common patterns, but there simply was no room within this process to test the implemented solution.</p>\n<p>And I was pretty confident with this workflow, properly planning ahead my tasks and implementing one small, comprehensible step at a time, in order for the software that I was producing to be of decent quality.</p>\n<p>It always seemed pretty intimidating to start with automated testing. There is so much to know about programming already, I can’t probably learn everything there is to learn about testing as well.</p>\n<p>How do I set up testing at all? What do I test for? What can I do if my implementation uses another class’ function? How do I even prepare the state of my application that I would need, to test a specific scenario?</p>\n<p>This is too much, surely I’m fine without this, I thought.</p>\n<p>Boy, was I wrong.</p>\n<h2>Getting a hold of TDD</h2>\n<p>A few weeks ago I was purchasing something from Amazon when I got the suggestion for a book: The Clean Coder. I took a look into the books reviews and although the book’s quite pricey and has aged somewhat, I rather quickly decided to get a hard copy and give it a try.</p>\n<p>Let me tell you, this book is well worth its cost!</p>\n<p>It goes into depth about what it means to be a professional programmer and how much farther our responsibility extends than just towards our code.</p>\n<h3>Chapter 5 — Test Driven Development</h3>\n<p>After being hooked by the first chapter, I seemingly devoured the book until I’ve reached chapter 5. There it was, the ubiquitous topic of testing.\nAnd this time I decided to give it a try for real.</p>\n</hr>\n<h2>First Steps</h2>\n<p>Most of the examples that were given to me about TDD, were applications that already had high a good amount of tests. But where would I start with my applications, that have had no tests at all?</p>\n<p>The plain and simple answer to this is: Anywhere!</p>\n<h3>Any tests are better than no tests</h3>\n<p>The hurdle of you writing your first test is not as big of a challenge as it might seem. You must not strive for 100% coverage or perfect tests, as they are an ever-evolving part of your code base.</p>\n<p>They too can be refactored and improved at a later stage, the key is just getting started.</p>\n<h2>My first test</h2>\n<p>There is no secret to testing, but to start small. The value of your tests will accumulate on its own and at some point provide great value to your code base.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Eloquent<span class=\"token punctuation\">\\</span>Model</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @return string\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFullNameAttribute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">first_name</span></span> <span class=\"token interpolation\"><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">last_name</span></span>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Our first goal is to test this existing class. Assuming we have not yet set up any tests and this code is already implemented.\nSimply run <code class=\"language-text\">php artisan make:test UserTest --unit</code> to create a test stub for you and this is what you will end up with.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Tests<span class=\"token punctuation\">\\</span>Unit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tests<span class=\"token punctuation\">\\</span>TestCase</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">UserTest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TestCase</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * A basic test example.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">testExample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertTrue</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>What we now want is to test, that our <code class=\"language-text\">getFullNameAttribute()</code> method indeed concatenates the first name and last name of our user to build the full name.</p>\n<p>Our first implementation of the test could look like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Tests<span class=\"token punctuation\">\\</span>Unit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>User</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tests<span class=\"token punctuation\">\\</span>TestCase</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">UserTest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TestCase</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/** @test */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">it_concatenates_first_and_last_name_to_build_the_full_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">first_name</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"John\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">last_name</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"Doe\"</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertTrue</span><span class=\"token punctuation\">(</span>\n            <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token function\">getFullNameAttribute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string double-quoted-string\">\"John Doe\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>The <code class=\"language-text\">@test</code> annotation describes to the underlying PhpUnit testing framework, that this function is a test.</p>\n<p>We specified a descriptive name for our method and built the state we require to make an assertion about our code. At a later point, we could refactor this to use <a href=\"https://laravel.com/docs/5.7/seeding\">Laravels model factories</a>, but as of now, this will suffice.</p>\n<p>If we run the code by executing PhpUnit from the command line <code class=\"language-text\">vendor/bin/phpunit</code> we should see all tests passing.</p>\n<p>To validate our test, change the first name to <code class=\"language-text\">Jane</code> and re-execute the test. It should now fail.</p>\n<h2>This was easy, what now?</h2>\n<p>Testing methods on classes, that do not require interaction with the outside world, is pretty straightforward. If, however, we would need to ask a service for a potential nickname of our user, this changes.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Eloquent<span class=\"token punctuation\">\\</span>Model</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @return string\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFullNameAttribute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$nickName</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">NicknameService</span><span class=\"token operator\">::</span><span class=\"token function\">getNickname</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">first_name</span></span> <span class=\"token interpolation\"><span class=\"token variable\">$nickName</span></span> <span class=\"token interpolation\"><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">last_name</span></span>\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">first_name</span></span> <span class=\"token interpolation\"><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">last_name</span></span>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>In order not to depend on the implementation of the NicknameService, we need to “mock” it. This means that we intercept the call to the service and return a static result.</p>\n<p>(This makes use of Laravel Facades, you can learn more about them <a href=\"https://laravel.com/docs/5.7/facades\">here</a>.)</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Tests<span class=\"token punctuation\">\\</span>Unit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>User</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Tests<span class=\"token punctuation\">\\</span>TestCase</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">UserTest</span>\n    <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TestCase</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token comment\">// first test ...</span>\n\n    <span class=\"token comment\">/** @test */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">it_puts_the_nickname_between_first_and_last_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">first_name</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"John\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">last_name</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"Doe\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name static-context\">NicknameService</span><span class=\"token operator\">::</span><span class=\"token function\">shouldReceive</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'getNickname'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">-></span><span class=\"token function\">once</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">-></span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">-></span><span class=\"token function\">andReturn</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"'The Outlaw'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                  \n        \n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertTrue</span><span class=\"token punctuation\">(</span>\n            <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token function\">getFullNameAttribute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string double-quoted-string\">\"John 'The Outlaw' Doe\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>What this test does should be pretty self-explanatory. By using a Facade we make it really easy to “mock” the result of the function and decouple it from the specific implementation of the actual Nickname service.</p>\n<p>Combined with factories and great helper methods, this makes for a really pleasant testing experience.</p>\n<h2>Reaping the benefits</h2>\n<p>If learning the practices of testing seems like overhead, you will quickly realize, that using a testing framework will remove a lot of manual testing and actually be a huge time saver.</p>\n<p>Furthermore, once the time was invested to implement a test, it can be re-run in the future without any effort, giving you the benefit of being sure, that your changes did not break the tested functionality.</p>\n<p>If you’ve always wanted to contribute to open source, but did not know how or where intimidated, that any contribution required tests to go along with it, you can now confidently go ahead and implement your feature with ease.</p>\n<p>In short, testing your code will give you a huge confidence boost in your code. Mistakes will still happen, we are human after all, but they will be much rarer and easier to track down.</p>\n<h2>Next Steps</h2>\n<p>As already mentioned, there is a lot to learn about testing. So go ahead and pick up a book, an online course or just read through the documentation of Laravel and PhpUnit.</p>\n<p>I can personally recommend Laracasts course on <a href=\"https://laracasts.com/series/phpunit-testing-in-laravel\">Testing Laravel</a>. Jeffrey Wey does a great job explaining TDD in more detail and gives useful tips that will make you better at testing immediately.</p>\n<p>When implementing new features, write tests, that describe your implementation, before actually implementing the functionality.</p>\n<h3>Links</h3>\n<ul>\n<li><a href=\"https://laravel.com/docs/5.7/testing\">https://laravel.com/docs/5.7/testing</a></li>\n<li><a href=\"https://phpunit.de/\">https://phpunit.de/</a></li>\n</ul>","id":"46b0b51b-481c-5db7-9435-e18d5cbd7ff7","frontmatter":{"title":"Getting started with Test Driven Development in Laravel","date":"December 07, 2018","tags":["laravel","php"],"excerpt":null},"fields":{"slug":"/2018-12-getting-started-with-test-driven-development-in-laravel/"}}},{"node":{"excerpt":"Lately, I have been developing an application based on Laravel 5.7 that makes heavy use of Laravels Queue feature. In order to easier structure different debug information for multiple hosts we use…","html":"<p>Lately, I have been developing an application based on Laravel 5.7 that makes heavy use of Laravels Queue feature.</p>\n<p>In order to easier structure different debug information for multiple hosts we use Elastic Logstash and Kibana.</p>\n<p>Laravel does not come with a pre-configured Logstash driver option, but I got it up and running with very little work.</p>\n<h2>Logstash Driver</h2>\n<p>Laravels logging configuration is placed within the <code class=\"language-text\">config/logging.php</code> file. In order to add our configuration for Logstash, we simply add a custom provider.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ... other configuration stuff</span>\n\n    <span class=\"token string single-quoted-string\">'channels'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// ... other channels like stack or single</span>\n\n        <span class=\"token string single-quoted-string\">'logstash'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'driver'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'custom'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'via'</span>    <span class=\"token operator\">=></span> <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>App<span class=\"token punctuation\">\\</span>LogstashLogger</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'host'</span>   <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'LOGSTASH_HOST'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'127.0.0.1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'port'</span>   <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'LOGSTASH_PORT'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4718</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>For more on how to define custom loggers, refer to the <a href=\"https://laravel.com/docs/5.7/logging#creating-channels-via-factories\">Laravel documentation</a>.</p>\n<h2>Logstash Logger Provider</h2>\n<p>So what does our factory class do? All it needs to do is to implement PHPs magic method <code class=\"language-text\">__invoke()</code> and return an instance of <code class=\"language-text\">\\Psr\\Log\\LoggerInterface</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Monolog<span class=\"token punctuation\">\\</span>Formatter<span class=\"token punctuation\">\\</span>LogstashFormatter</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Monolog<span class=\"token punctuation\">\\</span>Handler<span class=\"token punctuation\">\\</span>SocketHandler</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Monolog<span class=\"token punctuation\">\\</span>Logger</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Psr<span class=\"token punctuation\">\\</span>Log<span class=\"token punctuation\">\\</span>LoggerInterface</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">LogstashLogger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/**\n     * @param array $config\n     * @return LoggerInterface\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__invoke</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token class-name return-type\">LoggerInterface</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SocketHandler</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"udp://<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'host'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span>:<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'port'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$handler</span><span class=\"token operator\">-></span><span class=\"token function\">setFormatter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LogstashFormatter</span><span class=\"token punctuation\">(</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'app.name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'logstash.main'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token variable\">$handler</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n</br>\n<h2>… and done!</h2>\n<p>Now you are ready to use the custom channel to ship your logs via UDP to any Logstash Host that accepts data on the specified port.</p>\n<p>To use the new configuration add it to a logging channel of type <code class=\"language-text\">'stack'</code> or make use of it directly: <code class=\"language-text\">Log::channel('logstash')->debug('Logging to logstash');</code></p>","id":"317989a9-e64d-57eb-bf99-697442b47b06","frontmatter":{"title":"Using Logstash with Laravel","date":"November 13, 2018","tags":["laravel","php"],"excerpt":null},"fields":{"slug":"/2018-11-using-logstash-with-laravel/"}}}]}},"pageContext":{}},"staticQueryHashes":["2212750296","2457483284","3019618709","63159454"]}